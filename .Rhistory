slp_sum<-slp_jlvl$summary
slp_lvl<-slp_jsn1$levels
slp_sum<-slp_lvl$summary
View(slp_jsn1)
View(slp)
slp_jsn1<-slp_jsn1%>%
select(1:13)%>%
cbind(slp_sum)
View(slp_jsn1)
View(slp)
convert<- function (a){
b<-a$levels
c<-b$summary
a<-a%>%
select(1:13)%>%
cbind(c)
}
#Separate levels column
#Json files are better
slp_jsn1<-fromJSON("C:/Users/ricky/OneDrive/Desktop/School/R/FitBit/Datasets/Sleep/sleep-2020-09-30.json")
convert(slp_jsn1)
View(slp_jsn1)
convert<- function (a){
b<-a$levels
c<-b$summary
a<-a%>%
select(1:13)%>%
cbind(c)
return(a)
}
convert(slp_jsn1)
convert<- function (a){
b<-a$levels
c<-b$summary
a<-a%>%
select(1:13)%>%
cbind(c)
return(a)
}
convert(slp_jsn1)
convert<- function (a){
b<-a$levels
c<-b$summary
a<-a%>%
select(1:13)%>%
cbind(c)
return(a)
list2env(a,envir = .GlobalEnv)
}
convert(slp_jsn1)
my.list = lapply(slp_jsn1, convert)
my.list = lapply(slp_jsn1, convert)
my.list = map(slp_jsn1, convert)
convert<- function (a){
b<-a$levels
c<-b$summary
a<-a%>%
select(1:13)%>%
cbind(c)
return(a)
}
my.list = map(slp_jsn1, convert)
my.list = lapply(slp_jsn1, convert)
slp_lvl<-slp_jsn1$levels
slp_sum<-slp_lvl$summary
slp_jsn1<-slp_jsn1%>%
select(1:13)%>%
cbind(slp_sum)
slp_lvl<-slp_jsn2$levels
slp_sum<-slp_lvl$summary
slp_jsn2<-slp_jsn2%>%
select(1:13)%>%
cbind(slp_sum)
slp_lvl<-slp_jsn3$levels
slp_sum<-slp_lvl$summary
slp_jsn3<-slp_jsn3%>%
select(1:13)%>%
cbind(slp_sum)
slp_lvl<-slp_jsn4$levels
slp_sum<-slp_lvl$summary
slp_jsn4<-slp_jsn4%>%
select(1:13)%>%
cbind(slp_sum)
slp_lvl<-slp_jsn5$levels
slp_sum<-slp_lvl$summary
slp_jsn5<-slp_jsn5%>%
select(1:13)%>%
cbind(slp_sum)
slp_lvl<-slp_jsn6$levels
slp_sum<-slp_lvl$summary
slp_jsn6<-slp_jsn6%>%
select(1:13)%>%
cbind(slp_sum)
slp_merge<-do.call("rbind.fill", list(slp_jsn1, slp_jsn2, slp_jsn3,
slp_jsn4,slp_jsn5, slp_jsn6))
slp_merge<-do.call("rbind", list(slp_jsn1, slp_jsn2, slp_jsn3,
slp_jsn4,slp_jsn5, slp_jsn6))
View(slp_jsn1)
View(slp_jsn2)
View(slp_jsn5)
slp_merge<-do.call("rbind", list(slp_jsn1, slp_jsn2, slp_jsn3,
slp_jsn4,slp_jsn5, slp_jsn6) row.names=NULL)
slp_merge<-do.call("rbind", list(slp_jsn1, slp_jsn2, slp_jsn3,
slp_jsn4,slp_jsn5, slp_jsn6,
row.names=NULL))
#Separate levels column
#Json files are better
slp_jsn1<-fromJSON("C:/Users/ricky/OneDrive/Desktop/School/R/FitBit/Datasets/Sleep/sleep-2020-09-30.json",
row.names=NULL)
#Merge the resulting dataframes
rownames(slp_jsn1) <- c()
rownames(slp_jsn2) <- c()
rownames(slp_jsn3) <- c()
rownames(slp_jsn4) <- c()
rownames(slp_jsn5) <- c()
rownames(slp_jsn6) <- c()
slp_merge<-do.call("rbind", list(slp_jsn1, slp_jsn2, slp_jsn3,
slp_jsn4,slp_jsn5, slp_jsn6))
slp_merge<-rbind(slp_jsn4, slp_jsn5)
View(slp_sc)
#Merge the resulting dataframes
rownames(slp_jsn1) <- make.names(slp_jsn1[,1], unique = TRUE)
rownames(slp_jsn2) <- make.names(slp_jsn2[,1], unique = TRUE)
slp_merge<-rbind(slp_jsn1, slp_jsn2)
View(slp_jsn1)
View(slp_jsn2)
slp_merge<-rbind(slp_jsn1, slp_jsn3)
View(slp_sc)
View(slp)
#For each Json, extract the summary dataframe within the main dataframe
str(slp)
row.names(slp_jsn1) <- NULL
row.names(slp_jsn2) <- NULL
View(slp_jsn1)
slp_merge<-rbind(slp_jsn1, slp_jsn2)
path <- "./Dataset/"
files <- dir(path, pattern = "*.json")
data <- files %>%
map_df(~fromJSON(file.path(path, .), flatten = TRUE))
View(data)
data<-data%>%
select(-14:-16)
View(data)
View(slp_jsn1)
path <- "./Dataset/"
files <- dir(path, pattern = "*.json")
data <- files %>%
map_df(~fromJSON(file.path(path, .), flatten = TRUE))
View(slp)
#Remove redundant columns
data$dateOfSleep<-ymd(data$dateOfSleep)
View(data)
data<-data%>%
select(-1, -3:-6, -13:-16, contains(".count"),
contains("Avg"))
View(data)
path <- "./Dataset/"
files <- dir(path, pattern = "*.json")
data <- files %>%
map_df(~fromJSON(file.path(path, .), flatten = TRUE))
ata$dateOfSleep<-ymd(data$dateOfSleep)
data$dateOfSleep<-ymd(data$dateOfSleep)
data<-data%>%
select(-1, -3:-6, -13:-16, ends_with(".count"),
ends_with("AvgMinutes"))
View(data)
path <- "./Dataset/"
files <- dir(path, pattern = "*.json")
data <- files %>%
map_df(~fromJSON(file.path(path, .), flatten = TRUE))
#Remove redundant columns
data$dateOfSleep<-ymd(data$dateOfSleep)
View(data)
data<-data%>%
select(-1, -3:-6, -13:-16,-17, -19, -20, -22, -23,
-25, -26, -28, -29, -31, -33)
View(slp)
View(slp_sc)
#Import Sleep files Separate levels column
path <- "./Dataset/"
files <- dir(path, pattern = "*.json")
slp <- files %>%
map_df(~fromJSON(file.path(path, .), flatten = TRUE))
#Remove redundant columns
slp$dateOfSleep<-ymd(slp$dateOfSleep)
slp<-slp%>%
select(-1, -3:-6, -13:-16,-17, -19, -20, -22, -23,
-25, -26, -28, -29, -31, -33)
View(dis)
View(sam)
View(slp)
sum(is.na(slp$minutesAsleep))
min(slp$minutesAsleep)
View(dis)
View(slp)
View(dis)
library(tidyverse)
library(ggplot2)
library(plotly)
library(lubridate)
library(jsonlite)
#Keep data for the last 9 months only
alt2<-Map(alt, function(x) filter(date>=today()- months(9)))
#Keep data for the last 9 months only
alt2<-alt
con_date<-function(df){
df<-df%>%
filter(date>=today()- months(9))
return(df)
}
con_date(alt2)
dis2<-dis
con_date(dis2)
dis<-con_date(dis2)
View(dis2)
dis2<-dis
dis<-con_date(dis2)
View(dis)
dis<-read_csv("Dataset/Distance.csv")
dis<-dis%>%
separate(Date,
into=c("date", "time"),
sep=" ")%>%
select(-time)
dis$date<-mdy(dis$date)
dis<-dis%>%
rename(distance=Distance)
dis<-aggregate(dis["distance"], by=dis["date"], sum)
View(dis)
dis2<-dis
dis2<-con_date(dis2)
View(dis2)
dis<-con_date(dis)
alt<-con_date(alt)
View(alt)
View(alt)
View(dis)
View(hrt)
hrt<-con_date(hrt)
hrt<-con_date(hrt)
lam<-con_date(lam)
mam<-con_date(mam)
sam<-con_date(sam)
slp<-con_date(slp)
slp_sc<-con_date(slp_sc)
vam<-con_date(vam)
slp<-as_tibble(slp)
slp<-con_date(slp)
View(slp)
slp$dateOfSleep<-rename(date=dateOfSleep)
slp$dateOfSleep<-rename(date=slp$dateOfSleep)
slp<-slp%>%
rename(date=dateOfSleep)
slp<-con_date(slp)
View(slp)
View(slp)
slp2<-aggregate(slp[2:14], by=dis["date"], sum)
View(slp)
sum(is.na(slp$efficiency))
sum(duplicated(slp$date))
slp2<-slp%>%
group_by(date)%>%
select(-type)%>%
mutate(minutesAsleep=sum(minutesAsleep), minutesAwake=sum(minutesAwake),
minutesAfterWakeup=sum(minutesAfterWakeup),timeInBed=sum(timeInBed),
efficiency=mean(efficiency),levels.summary.deep.minutes=sum(levels.summary.deep.minutes),
levels.summary.wake.minutes=sum(levels.summary.wake.minutes), levels.summary.light.minutes=sum(levels.summary.light.minutes),
levels.summary.rem.minutes=sum(levels.summary.rem.minutes))%>%
mutate(levels.summary.restless.minutes=sum(levels.summary.restless.minutes),
levels.summary.awake.minutes=sum(levels.summary.awake.minutes),
levels.summary.asleep.minutes=sum(levels.summary.asleep.minutes))
View(slp2)
slp2<-slp%>%
select(-type)%>%
aggregate(.~date, sum)
slp2<-slp%>%
group_by(date)%>%
select(-type)%>%
summarise(across(starts_with('lev'), sum))%>%
summarise(across(starts_with('min'), sum))%>%
summarise(across(starts_with('eff'), mean))%>%
summarise(across(starts_with('tim'), sum))
View(slp2)
View(slp)
slp_ef_dt<-slp%>%
select(date,efficiency)
slp2<-slp%>%
select(-type)%>%
aggregate(. ~date, sum, na.rm=TRUE)
slp2<-slp%>%
select(-type)
slp2<-aggregate(. ~date,data=slp2, sum, na.rm=TRUE)
View(slp2)
slp2<-slp%>%
select(-type)%>%
mutate(day=day(date),
month=month(date,label=TRUE),
year=year(date))
View(slp2)
slp2<-aggregate(. ~day+month+year,data=slp2, sum, na.rm=TRUE)
slp2<-data.frame(slp2)
slp2<-aggregate(. ~day+month+year,data=slp2, sum, na.rm=TRUE)
nrow(slp2)
slp2<-aggregate(. ~day+month+year,data=slp2, sum, na.rm=TRUE, na.action=na.pass)
View(slp2)
colSums(is.na(slp))
slp3<-slp%>%
select(-type)%>%
aggregate(. ~date, sum, na.rm=TRUE, na.action=na.pass)
slp3<-slp%>%
select(-type)%>%
aggregate(. ~date, data = slp, sum, na.rm=TRUE, na.action=na.pass)
colSums(is.na(slp2))
slp4<-aggregate(. ~day+month+year,data=slp2, sum, na.rm=TRUE, na.omit)
slp4<-aggregate(. ~day+month+year,data=slp2, sum, na.rm=TRUE, na.omit=TRUE)
colSums(is.na(slp4))
slp4<-aggregate(. ~day+month+year,data=slp2, sum, na.rm=TRUE, na.exclude=TRUE)
colSums(is.na(slp4))
slp3<-slp%>%
select(-type)%>%
aggregate(. ~date, data = slp, sum, na.rm=TRUE, na.action=na.pass)
slp3<-aggregate(. ~date, data = slp3, sum, na.rm=TRUE, na.action=na.pass)
slp3<-slp%>%
select(-type)
slp3<-aggregate(. ~date, data = slp3, sum, na.rm=TRUE, na.action=na.pass)
colSums(is.na(slp3))
View(slp3)
#dealing with missing values
colSums(is.na(slp))
colSums(is.na(slp_sc))
max(slp$efficiency)
max(slp2$efficiency)
#Dealing with missing values to allow aggregation
colSums(is.na(slp))
slp<-slp%>%
select(-type)
slp<-aggregate(. ~date, data = slp, sum, na.rm=TRUE, na.action=na.pass)
colSums(is.na(slp))
max(slp$efficiency)
slp<-slp%>%
if (efficiency>100 & efficiency<=200){
mutate(mean_eff=efficiency/2)
}else if (efficiency>200){
mutate(mean_eff=efficiency/3)
} else {
mutate(mean_eff=efficiency)
}
}
slp2<-slp%>%
if (efficiency>100 & efficiency<=200){
mutate(mean_eff=efficiency/2)
}else if (efficiency>200){
mutate(mean_eff=efficiency/3)
} else {
mutate(mean_eff=efficiency)
}
slp2<- slp%>%
mutate(
mean_eff=case_when(
efficiency<100 ~ efficiency,
efficiency>100 & efficiency<=200 ~ efficiency/2,
TRUE ~ efficiency/3
))
slp2<- slp%>%
as.integer(efficiency)%>%
mutate(
mean_eff=case_when(
efficiency<100 ~ efficiency,
efficiency>100 & efficiency<=200 ~ efficiency/2,
TRUE ~ efficiency/3
))
colSums(is.na(slp))
slp<-slp%>%
select(-type, -efficiency)
slp<-aggregate(. ~date, data = slp, sum, na.rm=TRUE, na.action=na.pass)
View(slp)
path <- "./Dataset/"
files <- dir(path, pattern = "*.json")
slp <- files %>%
map_df(~fromJSON(file.path(path, .), flatten = TRUE))
slp$dateOfSleep<-ymd(slp$dateOfSleep)
slp<-slp%>%
select(-1, -3:-6, -13:-16,-17, -19, -20, -22, -23,
-25, -26, -28, -29, -31, -33)%>%
rename(date=dateOfSleep)%>%
as_tibble()
min(slp$minutesAsleep)
slp<-slp%>%
select(-type, -efficiency)
slp<-aggregate(. ~date, data = slp, sum, na.rm=TRUE, na.action=na.pass)
alt<-con_date(alt)
dis<-con_date(dis)
hrt<-con_date(hrt)
lam<-con_date(lam)
mam<-con_date(mam)
sam<-con_date(sam)
slp<-con_date(slp)
slp_sc<-con_date(slp_sc)
vam<-con_date(vam)
View(hrt)
View(slp_sc)
#Merge the files. left join to hrt dataset
merge<-hrt%>%
left_join(alt, by="date")
View(merge)
library(plyr)
#Merge the files. left join to hrt dataset
merge<-join_all(list(hrt,alt,dis,lam,mam,sam,
vam,slp,slp_sc), by="date", type = "left")
View(merge)
sum(is.na(merge$min_bpm))
merge1<-hrt%>%
left_join(alt, by="date")
merge1<-merge1%>%
left_join(dis, by="date")
View(merge1)
merge1<-merge1%>%
left_join(lam, by="date")
merge1<-merge1%>%
left_join(mam, by="date")
merge1<-merge1%>%
left_join(sam, by="date")
merge1<-merge1%>%
left_join(vam, by="date")
merge1<-merge1%>%
left_join(hrt, by="date")
merge1<-merge1%>%
left_join(slp, by="date")
merge1<-merge1%>%
left_join(slp_sc, by="date")
merge1<-hrt%>%
left_join(alt, by="date")
merge1<-merge1%>%
left_join(dis, by="date")
merge1<-merge1%>%
left_join(lam, by="date")
merge1<-merge1%>%
left_join(mam, by="date")
merge1<-merge1%>%
left_join(sam, by="date")
merge1<-merge1%>%
left_join(vam, by="date")
merge1<-merge1%>%
left_join(slp, by="date")
merge1<-merge1%>%
left_join(slp_sc, by="date")
sum(duplicated(merge$date))
sum(duplicated(slp_sc$date))
View(slp_sc)
dup<-duplicated(slp_sc$date)
slp_sc$date[dup]
slp_sc<-read_csv("Dataset/sleep_score.csv")
View(slp_sc)
slp_sc<-slp_sc%>%
separate(timestamp,
into=c("date", "time"),
sep=" ")%>%
select(-time, -sleep_log_entry_id)
slp_sc$date<-ymd(slp_sc$date)
View(slp)
slp_sc<-read_csv("Dataset/sleep_score.csv")
slp_sc<-slp_sc%>%
separate(timestamp,
into=c("date", "time"),
sep=" ")%>%
select(-time, -sleep_log_entry_id, deep_sleep_in_minutes)
slp_sc$date<-ymd(slp_sc$date)
View(slp)
View(slp_sc)
View(slp_sc)
slp_sc<-read_csv("Dataset/sleep_score.csv")
slp_sc<-slp_sc%>%
separate(timestamp,
into=c("date", "time"),
sep=" ")%>%
select(-time, -sleep_log_entry_id, -deep_sleep_in_minutes)
slp_sc$date<-ymd(slp_sc$date)
View(slp_sc)
slp_sc2<-slp_sc%>%
group_by(date)%>%
summarise(across(everything(), mean))
#Mutate columns for sleep score
slp_sc2<-slp_sc%>%
group_by(date)%>%
summarize(across(everything(), mean))
detach("package:dplyr", unload = TRUE)
library(dplyr)
#Mutate columns for sleep score
slp_sc2<-slp_sc%>%
group_by(date)%>%
summarize(across(everything(), mean))
sum(duplicated(slp_sc$date))
sum(duplicated(slp_sc2$date))
#Aggregate sleep score by date
slp_sc<-slp_sc%>%
group_by(date)%>%
summarize(across(everything(), mean))
sum(duplicated(slp_sc$date))
alt<-con_date(alt)
dis<-con_date(dis)
hrt<-con_date(hrt)
lam<-con_date(lam)
mam<-con_date(mam)
sam<-con_date(sam)
slp<-con_date(slp)
slp_sc<-con_date(slp_sc)
vam<-con_date(vam)
#Merge the files. left join to hrt dataset
merge<-join_all(list(hrt,alt,dis,lam,mam,sam,
vam,slp,slp_sc), by="date", type = "left")
sum(is.na(merge))
View(merge)
